version: 1.0
runtime: python311
build:
  commands:
    install:
      - pip3 install --upgrade pip
      - pip3 install -r requirements.txt
run:
  runtime-version: 3.11
  command: cd src && python3 server.py
  network:
    port: 8000
    env:
      - name: ENVIRONMENT
        value: "production"
      - name: AWS_SECRET_NAME
        value: "prod/adaptive-app"
      - name: AWS_REGION
        value: "ap-southeast-2"
      - name: HOST
        value: "0.0.0.0"
      - name: PORT
        value: "8000"
      - name: LOG_LEVEL
        value: "INFO"
      - name: WORKERS
        value: "1"
      - name: TIMEOUT_KEEP_ALIVE
        value: "65"
      - name: TIMEOUT_GRACEFUL_SHUTDOWN
        value: "30"
      - name: MAX_REQUESTS
        value: "1000"
      - name: MAX_REQUESTS_JITTER
        value: "100"
  instances:
    cpu: 512   # 0.5 vCPU
    memory: 1024  # 1 GB RAM
  auto-scaling:
    min-size: 1
    max-size: 2
    target-cpu: 70
    target-memory: 80
  health-check:
    path: "/health"
    interval: 30
    timeout: 5
    healthy-threshold: 2
    unhealthy-threshold: 5
    startup-grace-period: 60